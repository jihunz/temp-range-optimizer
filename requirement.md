# 🔥 LOT별 온도 피처 조합 기여도 및 불량률 최소화를 위한 최적 온도 범위 탐색 요구사항

## 🎯 **최종 목표**

LOT별 공정 데이터를 기반으로, 각 온도 피처 간 조합이 불량률에 미치는 **상호 기여도(interaction contribution)** 를 정량화하고, 이를 이용해 **불량률을 최소화하는 최적 온도 범위 조합을 도출**하는 것이 목적이다.

---

## 📂 **데이터 개요**

* 데이터셋 구성:
  * 경로: '/Users/jihunjang/Downloads/경진대회용 제조AI데이터셋/1. 열처리 공정최적화 AI 데이터셋/temp-range-optimizer/data'
  * 학습: `lot_dataset_train.csv`
  * 검증: `lot_dataset_val.csv`
  * 테스트: `lot_dataset_test.csv`
* 주요 컬럼: 약 140여 개의 센서 기반 피처
* 목표 변수(Target): `불량률` (연속값)
* 제외 컬럼: `LOT_NO`, `start_time`, `end_time`, `작업일`, `작업일_최신`, `양품수량`, `불량수량`, `총수량`

---

## ⚙️ **모델링 및 해석 요구사항**

### 1️⃣ 모델 학습 (XGBoost 기반)

* 알고리즘: `xgboost.XGBRegressor`
* 문제 유형: 회귀 (Regression)
* 입력 피처:

  * 기본 피처: 공정별 평균, 표준편차, min/max, zone별 온도 피처 등
  * 추가 피처: 도메인 엔지니어가 임의로 생성한 파생 피처(예: zone 간 온도차, gradient 등)를 **자유롭게 추가할 수 있는 구조로 설계**
* 평가 지표:

  * MAE, RMSE, R²

---

### 2️⃣ SHAP 기반 피처 기여도 및 상호작용 해석

* 목적: LOT별로 피처 간 조합(특히 온도 피처 쌍)이 불량률에 미치는 상호 영향을 정량적으로 분석
* 구현 요구사항:

  * 전체 피처 importance summary plot (전체 기여도 파악)
  * 주요 온도 피처 조합에 대한 SHAP dependence plot
  * `interaction_values`를 활용한 피처 간 상호작용 기여도 분석
  * 특정 LOT 단위로 SHAP 값을 집계하여 **LOT별 기여 패턴 차이 시각화**

#### 🔍 추가 해석 요구 (도메인 기반)

> "온도 피처 간 조합이 불량률에 미치는 상호작용 효과"를 정량적으로 측정하고, 불량률 최소화를 위한 조합 방향을 해석할 것.

* 예: `건조_1존_OP_mean` ↑ 와 `소입로_온도_1_4_mean_diff` ↓ 조합이 불량률 저감에 기여하는지 확인
* SHAP interaction value heatmap 및 3D surface plot으로 표현

---

### 3️⃣ 불량률 최소화를 위한 최적 온도 조합 탐색

* 탐색 대상 피처: 주요 온도 관련 피처 (예: `건조_*`, `소입로_*`, `솔트조_*`)
* 탐색 범위: 각 피처의 min~max 범위 기반 실측값 제한 내
* 탐색 방법:

  * **그리드 서치(Grid Search)** 또는 **베이지안 최적화(Bayesian Optimization)**
  * 탐색 과정에서 예측 불량률(`XGB.predict`)을 이용해 최소값 도출
* 출력 형태:

  ```
  LOT별 최적 온도 조합:
    LOT_NO: HZA02
    건조_1존_OP_mean: 72.3°C
    소입로_온도_1_4_mean_diff: -0.22°C
    솔트조_온도_mean_diff: 0.01°C
    예상 불량률: 0.000156
  ```

---

## 📊 **시각화 요구사항**

* SHAP summary plot: 전체 피처 기여도
* SHAP interaction heatmap: 피처 쌍 간 상호작용 강도
* 3D surface plot: 주요 온도 피처 조합과 불량률 예측면 시각화
* LOT별 SHAP 기여도 비교 그래프 (bar chart)

---

## 🧩 **스크립트 구성 제안**

| 파일명                            | 주요 기능                                               |
| :----------------------------- | :-------------------------------------------------- |
| `train_xgboost.py`             | 모델 학습, 성능 저장, feature importance 출력                 |
| `analyze_shap_interaction.py`  | SHAP 값 계산, dependence plot 및 interaction heatmap 생성 |
| `optimize_temp_combination.py` | 최적 온도 조합 탐색 및 불량률 최소화 계산                            |
| `evaluate_by_lot.py`           | LOT별 예측/실측 불량률 비교 및 SHAP 패턴 분석                      |

---

## 🧑‍💻 **기술 스택 요구사항**

* Python ≥ 3.12
* 필수 라이브러리:

  * `xgboost`, `shap`, `sklearn`, `optuna`, `pandas`, `numpy`
  * `matplotlib`, `seaborn`, `plotly` (시각화용)

---

## 🧠 **결과 해석 목표 요약**

1. LOT별 주요 온도 피처의 개별 및 조합 기여도를 정량적으로 해석한다.
2. SHAP 상호작용 분석을 통해 **온도 피처 간 최적 조합 방향성**을 도출한다.
3. XGBoost 예측 모델을 이용해 **불량률을 최소화하는 온도 범위 조합을 탐색하고 시각화**한다.

---

## 📐 요구 사항 (Requirement)

### 1. 구현 작업 원칙

* **SOLID 원칙**을 사용해서 구현하세요.
* **Clean Architecture**를 사용해서 구현하세요.

### 2. 코드 품질 원칙

* **단순성**: 언제나 복잡한 솔루션보다 가장 단순한 솔루션을 우선시하세요.
* **중복 방지**: 코드 중복을 피하고, 가능한 기존 기능을 재사용하세요 (**DRY 원칙**).
* **가드레일**: 테스트 외에는 개발이나 프로덕션 환경에서 모의 데이터를 사용하지 마세요.
* **효율성**: 명확성을 희생하지 않으면서 토큰 사용을 최소화하도록 출력을 최적화하세요.

### 3. 리팩토링

* 리팩토링이 필요한 경우 **계획을 설명**하고 **허락을 받은 다음** 진행하세요.
* 코드 구조를 개선하는 것이 목표이며, **기능 변경은 아닙니다**.
* 리팩토링 후에는 **모든 테스트가 통과**하는지 확인하세요.

### 4. 디버깅

* 디버깅 시에는 **원인 및 해결책을 설명**하고 **허락을 받은 다음** 진행하세요.
* 에러 해결이 중요한 것이 아니라 **제대로 동작하는 것**이 중요합니다.
